<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BGN ‚áÑ EUR ‚Ä¢ –†–µ—Å—Ç–æ ‚Ä¢ –ú–∞—Ä–∂ (–∫–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏) ‚Ä¢ –î–î–°</title>
  <style>
    :root { --bg:#0b1020; --card:#121a33; --txt:#e9eefc; --mut:#a8b3d6; --acc:#7aa2ff; --ok:#3ddc97; --bad:#ff6b6b; --warn:#ffcc66; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background: radial-gradient(1200px 600px at 20% 0%, #16224a, var(--bg)); color:var(--txt); }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
    h1 { font-size: 20px; margin: 6px 0 12px; }
    .rate { color: var(--mut); font-size: 13px; margin-bottom: 14px; }
    .grid { display:grid; gap:14px; grid-template-columns: 1fr; }
    @media (min-width: 980px){ .grid { grid-template-columns: 1fr 1fr; } }
    .card { background: rgba(18,26,51,.92); border: 1px solid rgba(122,162,255,.18); border-radius: 14px; padding: 14px; box-shadow: 0 10px 25px rgba(0,0,0,.22); }
    .card h2 { margin: 0 0 10px; font-size: 16px; }
    label { display:block; font-size: 12px; color: var(--mut); margin: 10px 0 6px; }
    input, select { width:100%; padding: 10px 12px; border-radius: 10px; border:1px solid rgba(255,255,255,.12); background: rgba(8,12,25,.7); color: var(--txt); outline:none; }
    input:focus, select:focus { border-color: rgba(122,162,255,.6); }
    .row { display:grid; grid-template-columns: 1fr 120px; gap:10px; }
    .btns { display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    button { padding: 10px 12px; border-radius: 12px; border:1px solid rgba(122,162,255,.35); background: rgba(122,162,255,.15); color: var(--txt); cursor:pointer; font-weight:600; }
    button:hover { background: rgba(122,162,255,.22); }
    .ghost { background: transparent; }
    .out { margin-top: 12px; padding: 12px; border-radius: 12px; background: rgba(8,12,25,.55); border:1px solid rgba(255,255,255,.10); }
    .big { font-size: 18px; font-weight: 800; }
    .mut { color: var(--mut); font-size: 13px; margin-top: 6px; line-height: 1.35; }
    .ok { color: var(--ok); }
    .bad { color: var(--bad); }
    .warn { color: var(--warn); }
    .footer { margin-top: 14px; color: var(--mut); font-size: 12px; }
    .pill { display:inline-block; padding:4px 8px; border-radius: 999px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06); }
    .hidden { display:none; }
    .hr { height:1px; background: rgba(255,255,255,.10); margin: 10px 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üí± BGN ‚áÑ EUR ‚Ä¢ ü™ô –†–µ—Å—Ç–æ ‚Ä¢ üìà –ú–∞—Ä–∂ (–∫–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏) ‚Ä¢ üßæ –î–î–°</h1>
    <div class="rate">
      –ö—É—Ä—Å: <span class="pill">1 EUR = 1.95583 BGN</span>
      ‚Ä¢ –î–î–°: <span class="pill">20%</span>
      ‚Ä¢ –ó–∞–∫—Ä—ä–≥–ª—è–Ω–µ: 2 –∑–Ω–∞–∫–∞
    </div>

    <div class="grid">

      <div class="card">
        <h2>–ö–æ–Ω–≤–µ—Ä—Ç–æ—Ä</h2>

        <label>–°—É–º–∞</label>
        <div class="row">
          <input id="amt" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 12.50" />
          <select id="fromCcy">
            <option value="BGN">BGN</option>
            <option value="EUR">EUR</option>
          </select>
        </div>

        <label>–ö—ä–º</label>
        <select id="toCcy">
          <option value="EUR">EUR</option>
          <option value="BGN">BGN</option>
        </select>

        <div class="btns">
          <button id="btnConvert">Convert</button>
          <button class="ghost" id="btnSwap">Swap</button>
          <button class="ghost" id="btnFill1">10 BGN</button>
          <button class="ghost" id="btnFill2">10 EUR</button>
        </div>

        <div class="out" id="convOut">
          <div class="mut">–í—ä–≤–µ–¥–∏ —Å—É–º–∞ –∏ –Ω–∞—Ç–∏—Å–Ω–∏ Convert.</div>
        </div>
      </div>

      <div class="card">
        <h2>–†–µ—Å—Ç–æ (–ø–ª–∞—â–∞—à –≤ –µ–¥–Ω–∞ –≤–∞–ª—É—Ç–∞, –≤—Ä—ä—â–∞—à –≤ –¥—Ä—É–≥–∞)</h2>

        <label>–¶–µ–Ω–∞</label>
        <div class="row">
          <input id="price" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 18.50" />
          <select id="priceCcy">
            <option value="BGN">BGN</option>
            <option value="EUR">EUR</option>
          </select>
        </div>

        <label>–ü–ª–∞—Ç–µ–Ω–æ</label>
        <div class="row">
          <input id="paid" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 20" />
          <select id="paidCcy">
            <option value="EUR">EUR</option>
            <option value="BGN">BGN</option>
          </select>
        </div>

        <label>–í—Ä—ä—â–∞–º –≤</label>
        <select id="returnCcy">
          <option value="BGN">BGN</option>
          <option value="EUR">EUR</option>
        </select>

        <div class="btns">
          <button id="btnChange">Calculate change</button>
          <button class="ghost" id="btnAutoReturn">Auto (–¥—Ä—É–≥–∞—Ç–∞)</button>
          <button class="ghost" id="btnExample">–ü—Ä–∏–º–µ—Ä</button>
        </div>

        <div class="out" id="changeOut">
          <div class="mut">–ü–æ–ø—ä–ª–Ω–∏ —Ü–µ–Ω–∞ –∏ –ø–ª–∞—Ç–µ–Ω–æ –∏ –Ω–∞—Ç–∏—Å–Ω–∏ Calculate change.</div>
        </div>
      </div>

      <div class="card" id="margin">
        <h2>üìà –ú–∞—Ä–∂ (—Ü–µ–ª–µ–≤–∏ / –ø—Ä–æ–≤–µ—Ä–∫–∞) ‚Äî –ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏ + –î–î–°</h2>

        <div class="btns">
          <button id="mModeTarget">Target</button>
          <button class="ghost" id="mModeCheck">Check</button>
          <button class="ghost" id="mClear">Clear</button>
        </div>

        <div id="mTargetBox">
          <label>–†–∞–∑—Ö–æ–¥ –∫—ä–º –º–µ–Ω (Cost to me)</label>
          <div class="row">
            <input id="mCost" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 7500" />
            <select id="mCostCcy">
              <option value="BGN">BGN</option>
              <option value="EUR">EUR</option>
            </select>
          </div>

          <label>–ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏ / —Ç—Ä–µ—Ç–∏ –ª–∏—Ü–∞ (Consultants)</label>
          <input id="mConsult" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 2500 (–∞–∫–æ –Ω—è–º–∞ ‚Äî –æ—Å—Ç–∞–≤–∏ –ø—Ä–∞–∑–Ω–æ)" />

          <label>–¶–µ–ª–µ–≤–∏ –º–∞—Ä–∂ % (Margin, –±–µ–∑ –î–î–°)</label>
          <input id="mTarget" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 20" />

          <div class="btns">
            <button id="mCalcTarget">Calculate selling price</button>
            <button class="ghost" id="mExampleTarget">–ü—Ä–∏–º–µ—Ä</button>
          </div>

          <div class="mut">
            –ú–∞—Ä–∂ (–±–µ–∑ –î–î–°): <span class="pill">S = B / (1 ‚àí m)</span>, B = (Cost to me + Consultants)
          </div>
        </div>

        <div id="mCheckBox" class="hidden">
          <label>–†–∞–∑—Ö–æ–¥ –∫—ä–º –º–µ–Ω (Cost to me)</label>
          <div class="row">
            <input id="mCost2" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 7500" />
            <select id="mCcy2">
              <option value="BGN">BGN</option>
              <option value="EUR">EUR</option>
            </select>
          </div>

          <label>–ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏ / —Ç—Ä–µ—Ç–∏ –ª–∏—Ü–∞ (Consultants)</label>
          <input id="mConsult2" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 2500" />

          <label>–¶–µ–Ω–∞ –∫—ä–º –∫–ª–∏–µ–Ω—Ç–∞</label>
          <input id="mSell2" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 12500" />

          <label>–¶–µ–Ω–∞—Ç–∞ –µ‚Ä¶</label>
          <select id="mSellMode2">
            <option value="ex">–±–µ–∑ –î–î–°</option>
            <option value="inc">—Å –î–î–°</option>
          </select>

          <label>–¶–µ–ª–µ–≤–∏ –º–∞—Ä–∂ % (–ø–æ –∂–µ–ª–∞–Ω–∏–µ –∑–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ)</label>
          <input id="mTarget2" inputmode="decimal" placeholder="–Ω–∞–ø—Ä. 20" />

          <div class="btns">
            <button id="mCalcCheck">Calculate margin</button>
            <button class="ghost" id="mExampleCheck">–ü—Ä–∏–º–µ—Ä</button>
          </div>

          <div class="mut">
            –ú–∞—Ä–∂ = (S ‚àí B) / S, –∫—ä–¥–µ—Ç–æ S –µ –±–µ–∑ –î–î–°.
          </div>
        </div>

        <div class="out" id="mOut">
          <div class="mut">–ò–∑–±–µ—Ä–∏ Target –∏–ª–∏ Check.</div>
        </div>
      </div>

    </div>

    <div class="footer">
      –†–∞–±–æ—Ç–∏ –ª–æ–∫–∞–ª–Ω–æ –≤ –±—Ä–∞—É–∑—ä—Ä–∞ (–Ω—è–º–∞ –±–µ–∫–µ–Ω–¥). –ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ: –¥–æ—Å—Ç—ä–ø —Å–∞–º–æ –ø—Ä–µ–∑ VPN/LAN.
    </div>
  </div>

<script>
  const RATE = 1.95583;
  const VAT = 0.20;

  const q2 = (n) => Math.round((n + Number.EPSILON) * 100) / 100;

  const parseNum = (v) => {
    if (v === null || v === undefined) return NaN;
    const s = String(v).trim();
    if (!s) return NaN;
    return Number(s.replace(/\s+/g,'').replace(',', '.'));
  };

  const toBGN = (amt, ccy) => ccy === 'BGN' ? amt : (amt * RATE);
  const fromBGN = (amtBGN, ccy) => ccy === 'BGN' ? amtBGN : (amtBGN / RATE);

  const fmtBoth = (amt, ccy) => {
    const bgn = toBGN(amt, ccy);
    return `${q2(fromBGN(bgn,'BGN'))} BGN / ${q2(fromBGN(bgn,'EUR'))} EUR`;
  };

  // ---------------- Converter ----------------
  const amt = document.getElementById('amt');
  const fromCcy = document.getElementById('fromCcy');
  const toCcy = document.getElementById('toCcy');
  const convOut = document.getElementById('convOut');

  const renderConv = () => {
    const a = parseNum(amt.value);
    const f = fromCcy.value;
    const t = toCcy.value;

    if (!Number.isFinite(a)) {
      convOut.innerHTML = `<div class="bad">‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω–∞ —Å—É–º–∞.</div>`;
      return;
    }

    const bgn = toBGN(a, f);
    const out = fromBGN(bgn, t);

    convOut.innerHTML = `
      <div class="big">üí± ${q2(a)} ${f} = ${q2(out)} ${t}</div>
      <div class="mut">–ï–∫–≤–∏–≤–∞–ª–µ–Ω—Ç: ${q2(fromBGN(bgn,'BGN'))} BGN / ${q2(fromBGN(bgn,'EUR'))} EUR</div>
    `;
  };

  document.getElementById('btnConvert').onclick = renderConv;
  document.getElementById('btnSwap').onclick = () => {
    const f = fromCcy.value;
    fromCcy.value = toCcy.value;
    toCcy.value = f;
    renderConv();
  };
  document.getElementById('btnFill1').onclick = () => { amt.value = "10"; fromCcy.value = "BGN"; toCcy.value = "EUR"; renderConv(); };
  document.getElementById('btnFill2').onclick = () => { amt.value = "10"; fromCcy.value = "EUR"; toCcy.value = "BGN"; renderConv(); };
  amt.addEventListener('keydown', (e)=>{ if(e.key==='Enter') renderConv(); });

  // ---------------- Change ----------------
  const price = document.getElementById('price');
  const priceCcy = document.getElementById('priceCcy');
  const paid = document.getElementById('paid');
  const paidCcy = document.getElementById('paidCcy');
  const returnCcy = document.getElementById('returnCcy');
  const changeOut = document.getElementById('changeOut');

  const autoReturn = () => {
    returnCcy.value = (paidCcy.value === 'BGN') ? 'EUR' : 'BGN';
  };

  const renderChange = () => {
    const p = parseNum(price.value);
    const pc = priceCcy.value;
    const pay = parseNum(paid.value);
    const payc = paidCcy.value;
    const rc = returnCcy.value;

    if (!Number.isFinite(p) || !Number.isFinite(pay)) {
      changeOut.innerHTML = `<div class="bad">‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω–∞ —Ü–µ–Ω–∞ –∏–ª–∏ –ø–ª–∞—Ç–µ–Ω–æ.</div>`;
      return;
    }

    const pBGN = toBGN(p, pc);
    const payBGN = toBGN(pay, payc);
    const diffBGN = payBGN - pBGN;

    // Totals in both currencies
    const priceBoth = `${q2(fromBGN(pBGN,'BGN'))} BGN / ${q2(fromBGN(pBGN,'EUR'))} EUR`;
    const paidBoth  = `${q2(fromBGN(payBGN,'BGN'))} BGN / ${q2(fromBGN(payBGN,'EUR'))} EUR`;

    if (diffBGN < 0) {
      const missingBGN = -diffBGN;
      changeOut.innerHTML = `
        <div class="bad big">‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –ø–ª–∞—â–∞–Ω–µ</div>
        <div class="mut"><b>–¶–µ–Ω–∞:</b> ${priceBoth}</div>
        <div class="mut"><b>–ü–ª–∞—Ç–µ–Ω–æ:</b> ${paidBoth}</div>
        <div class="hr"></div>
        <div class="mut"><b>–õ–∏–ø—Å–≤–∞—Ç:</b> ${q2(missingBGN)} BGN / ${q2(fromBGN(missingBGN,'EUR'))} EUR</div>
      `;
      return;
    }

    const changeInReturn = fromBGN(diffBGN, rc);
    const changeBoth = `${q2(fromBGN(diffBGN,'BGN'))} BGN / ${q2(fromBGN(diffBGN,'EUR'))} EUR`;

    changeOut.innerHTML = `
      <div class="ok big">‚úÖ –†–µ—Å—Ç–æ: ${q2(changeInReturn)} ${rc}</div>
      <div class="mut"><b>–¶–µ–Ω–∞:</b> ${priceBoth}</div>
      <div class="mut"><b>–ü–ª–∞—Ç–µ–Ω–æ:</b> ${paidBoth}</div>
      <div class="hr"></div>
      <div class="mut"><b>–†–µ—Å—Ç–æ (–µ–∫–≤–∏–≤–∞–ª–µ–Ω—Ç):</b> ${changeBoth}</div>
    `;
  };

  document.getElementById('btnAutoReturn').onclick = () => { autoReturn(); renderChange(); };
  document.getElementById('btnChange').onclick = renderChange;
  document.getElementById('btnExample').onclick = () => {
    price.value = "18.50"; priceCcy.value = "BGN";
    paid.value = "20"; paidCcy.value = "EUR";
    autoReturn();
    renderChange();
  };

  // ---------------- Margin (Target / Check) ----------------
  const mTargetBox = document.getElementById('mTargetBox');
  const mCheckBox  = document.getElementById('mCheckBox');
  const mOut = document.getElementById('mOut');

  const mCost = document.getElementById('mCost');
  const mCostCcy = document.getElementById('mCostCcy');
  const mConsult = document.getElementById('mConsult');
  const mTarget = document.getElementById('mTarget');

  const mCost2 = document.getElementById('mCost2');
  const mCcy2  = document.getElementById('mCcy2');
  const mConsult2 = document.getElementById('mConsult2');
  const mSell2 = document.getElementById('mSell2');
  const mSellMode2 = document.getElementById('mSellMode2');
  const mTarget2 = document.getElementById('mTarget2');

  const setMode = (mode) => {
    const tBtn = document.getElementById('mModeTarget');
    const cBtn = document.getElementById('mModeCheck');

    if (mode === 'target') {
      mTargetBox.classList.remove('hidden');
      mCheckBox.classList.add('hidden');
      tBtn.classList.remove('ghost');
      cBtn.classList.add('ghost');
      mOut.innerHTML = `<div class="mut">–í—ä–≤–µ–¥–∏ —Ä–∞–∑—Ö–æ–¥ –∫—ä–º –º–µ–Ω, –∫–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏ (–ø–æ –∂–µ–ª–∞–Ω–∏–µ) –∏ —Ü–µ–ª–µ–≤–∏ –º–∞—Ä–∂ %.</div>`;
    } else {
      mTargetBox.classList.add('hidden');
      mCheckBox.classList.remove('hidden');
      tBtn.classList.add('ghost');
      cBtn.classList.remove('ghost');
      mOut.innerHTML = `<div class="mut">–í—ä–≤–µ–¥–∏ —Ä–∞–∑—Ö–æ–¥, –∫–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏ –∏ —Ü–µ–Ω–∞ –∫—ä–º –∫–ª–∏–µ–Ω—Ç–∞ (—Å/–±–µ–∑ –î–î–°), –∑–∞ –¥–∞ –≤–∏–¥–∏—à —Ä–µ–∞–ª–Ω–∏—è –º–∞—Ä–∂.</div>`;
    }
  };

  const warnIcon = (cond) => cond ? `<span class="warn">‚ö†Ô∏è</span>` : "";

  const calcTargetMargin = () => {
    const costToMe = parseNum(mCost.value);
    const ccy  = mCostCcy.value;
    const consultants = Number.isFinite(parseNum(mConsult.value)) ? parseNum(mConsult.value) : 0;
    const targ = parseNum(mTarget.value);

    if (!Number.isFinite(costToMe) || !Number.isFinite(targ)) {
      mOut.innerHTML = `<div class="bad">‚ùå –ù–µ–≤–∞–ª–∏–¥–µ–Ω —Ä–∞–∑—Ö–æ–¥ –∏–ª–∏ –º–∞—Ä–∂.</div>`;
      return;
    }

    const m = targ / 100;
    if (m <= 0 || m >= 0.99) {
      mOut.innerHTML = `<div class="bad">‚ùå –ú–∞—Ä–∂—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –º–µ–∂–¥—É 0 –∏ 99%.</div>`;
      return;
    }

    const baseCost = costToMe + consultants;           // B (–±–µ–∑ –î–î–°)
    const sellEx = baseCost / (1 - m);                 // S (–±–µ–∑ –î–î–°)
    const sellInc = sellEx * (1 + VAT);

    const profitTotal = sellEx - baseCost;             // –æ–±—â–∞ –ø–µ—á–∞–ª–±–∞ –Ω–∞–¥ B
    const firmProfit  = sellEx - costToMe - consultants; // –ø–µ—á–∞–ª–±–∞ –∑–∞ —Ñ–∏—Ä–º–∞—Ç–∞ (–Ω–∞–¥ costToMe –∏ —Å–ª–µ–¥ –∫–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏)

    const isWarn = consultants > firmProfit;

    // equivalents
    const sellBGN = toBGN(sellEx, ccy);
    const sellIncBGN = toBGN(sellInc, ccy);

    mOut.innerHTML = `
      <div class="ok big">‚úÖ –¶–µ–Ω–∞ –∫—ä–º –∫–ª–∏–µ–Ω—Ç–∞ (–±–µ–∑ –î–î–°): ${q2(sellEx)} ${ccy}</div>
      <div class="mut"><b>–¶–µ–Ω–∞ —Å –î–î–°:</b> ${q2(sellInc)} ${ccy}</div>
      <div class="hr"></div>
      <div class="mut"><b>Cost to me:</b> ${q2(costToMe)} ${ccy}</div>
      <div class="mut"><b>–ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏:</b> ${q2(consultants)} ${ccy}</div>
      <div class="mut"><b>Base (Cost+Consultants):</b> ${q2(baseCost)} ${ccy}</div>
      <div class="hr"></div>
      <div class="mut"><b>–û–±—â–∞ –ø–µ—á–∞–ª–±–∞ (–Ω–∞–¥ Base):</b> ${q2(profitTotal)} ${ccy}</div>
      <div class="mut"><b>–ü–µ—á–∞–ª–±–∞ –∑–∞ —Ñ–∏—Ä–º–∞—Ç–∞:</b> ${q2(firmProfit)} ${ccy} ${warnIcon(isWarn)} ${isWarn ? '<span class="warn">–ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏—Ç–µ –Ω–∞–¥–≤–∏—à–∞–≤–∞—Ç –ø–µ—á–∞–ª–±–∞—Ç–∞ –∑–∞ —Ñ–∏—Ä–º–∞—Ç–∞.</span>' : ''}</div>
      <div class="mut"><b>–ú–∞—Ä–∂:</b> ${q2((profitTotal / sellEx) * 100)}%</div>
      <div class="hr"></div>
      <div class="mut"><b>–ï–∫–≤–∏–≤–∞–ª–µ–Ω—Ç (–±–µ–∑ –î–î–°):</b> ${q2(fromBGN(sellBGN,'BGN'))} BGN / ${q2(fromBGN(sellBGN,'EUR'))} EUR</div>
      <div class="mut"><b>–ï–∫–≤–∏–≤–∞–ª–µ–Ω—Ç (—Å –î–î–°):</b> ${q2(fromBGN(sellIncBGN,'BGN'))} BGN / ${q2(fromBGN(sellIncBGN,'EUR'))} EUR</div>
    `;
  };

  const calcCheckMargin = () => {
    const costToMe = parseNum(mCost2.value);
    const ccy  = mCcy2.value;
    const consultants = Number.isFinite(parseNum(mConsult2.value)) ? parseNum(mConsult2.value) : 0;
    const sellInput = parseNum(mSell2.value);
    const sellMode = mSellMode2.value; // ex or inc
    const targ = parseNum(mTarget2.value);

    if (!Number.isFinite(costToMe) || !Number.isFinite(sellInput)) {
      mOut.innerHTML = `<div class="bad">‚ùå –ù–µ–≤–∞–ª–∏–¥–µ–Ω —Ä–∞–∑—Ö–æ–¥ –∏–ª–∏ —Ü–µ–Ω–∞ –∫—ä–º –∫–ª–∏–µ–Ω—Ç–∞.</div>`;
      return;
    }
    if (sellInput <= 0) {
      mOut.innerHTML = `<div class="bad">‚ùå –¶–µ–Ω–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ > 0.</div>`;
      return;
    }

    const sellEx = (sellMode === 'inc') ? (sellInput / (1 + VAT)) : sellInput;
    const sellInc = sellEx * (1 + VAT);

    const baseCost = costToMe + consultants;
    const profitTotal = sellEx - baseCost;
    const margin = (profitTotal / sellEx) * 100;

    const firmProfit  = sellEx - costToMe - consultants;
    const isWarn = consultants > firmProfit;

    const okVsTarget = Number.isFinite(targ)
      ? (margin >= targ ? `<span class="ok">‚úÖ –Ω–∞–¥/—Ä–∞–≤–Ω–æ –Ω–∞ —Ü–µ–ª—Ç–∞</span>` : `<span class="bad">‚ùå –ø–æ–¥ —Ü–µ–ª—Ç–∞</span>`)
      : '';

    mOut.innerHTML = `
      <div class="big">${profitTotal >= 0 ? '‚úÖ' : '‚ùå'} –†–µ–∞–ª–µ–Ω –º–∞—Ä–∂ (–±–µ–∑ –î–î–°): <b>${q2(margin)}%</b> ${okVsTarget ? '‚Ä¢ ' + okVsTarget : ''}</div>
      <div class="mut"><b>–¶–µ–Ω–∞ –±–µ–∑ –î–î–°:</b> ${q2(sellEx)} ${ccy} ‚Ä¢ <b>–¶–µ–Ω–∞ —Å –î–î–°:</b> ${q2(sellInc)} ${ccy}</div>
      <div class="hr"></div>
      <div class="mut"><b>Cost to me:</b> ${q2(costToMe)} ${ccy}</div>
      <div class="mut"><b>–ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏:</b> ${q2(consultants)} ${ccy}</div>
      <div class="mut"><b>Base (Cost+Consultants):</b> ${q2(baseCost)} ${ccy}</div>
      <div class="hr"></div>
      <div class="mut"><b>–û–±—â–∞ –ø–µ—á–∞–ª–±–∞ (–Ω–∞–¥ Base):</b> ${q2(profitTotal)} ${ccy}</div>
      <div class="mut"><b>–ü–µ—á–∞–ª–±–∞ –∑–∞ —Ñ–∏—Ä–º–∞—Ç–∞:</b> ${q2(firmProfit)} ${ccy} ${warnIcon(isWarn)} ${isWarn ? '<span class="warn">–ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç–∏—Ç–µ –Ω–∞–¥–≤–∏—à–∞–≤–∞—Ç –ø–µ—á–∞–ª–±–∞—Ç–∞ –∑–∞ —Ñ–∏—Ä–º–∞—Ç–∞.</span>' : ''}</div>
    `;
  };

  document.getElementById('mModeTarget').onclick = () => setMode('target');
  document.getElementById('mModeCheck').onclick  = () => setMode('check');
  document.getElementById('mCalcTarget').onclick = calcTargetMargin;
  document.getElementById('mCalcCheck').onclick  = calcCheckMargin;

  document.getElementById('mExampleTarget').onclick = () => {
    mCost.value = "7500";
    mCostCcy.value = "BGN";
    mConsult.value = "2500";
    mTarget.value = "20";
    calcTargetMargin();
  };

  document.getElementById('mExampleCheck').onclick = () => {
    mCost2.value = "7500";
    mCcy2.value = "BGN";
    mConsult2.value = "2500";
    mSell2.value = "12500";
    mSellMode2.value = "ex";
    mTarget2.value = "20";
    calcCheckMargin();
  };

  document.getElementById('mClear').onclick = () => {
    amt.value = ""; price.value = ""; paid.value = "";
    mCost.value = ""; mConsult.value = ""; mTarget.value = "";
    mCost2.value = ""; mConsult2.value = ""; mSell2.value = ""; mTarget2.value = "";
    convOut.innerHTML = `<div class="mut">–í—ä–≤–µ–¥–∏ —Å—É–º–∞ –∏ –Ω–∞—Ç–∏—Å–Ω–∏ Convert.</div>`;
    changeOut.innerHTML = `<div class="mut">–ü–æ–ø—ä–ª–Ω–∏ —Ü–µ–Ω–∞ –∏ –ø–ª–∞—Ç–µ–Ω–æ –∏ –Ω–∞—Ç–∏—Å–Ω–∏ Calculate change.</div>`;
    mOut.innerHTML = `<div class="mut">–ò–∑–±–µ—Ä–∏ Target –∏–ª–∏ Check.</div>`;
  };

  // sensible defaults
  fromCcy.value = "BGN";
  toCcy.value = "EUR";
  priceCcy.value = "BGN";
  paidCcy.value = "EUR";
  autoReturn();

  mCostCcy.value = "BGN";
  mCcy2.value = "BGN";
  setMode('target');
</script>
</body>
</html>
